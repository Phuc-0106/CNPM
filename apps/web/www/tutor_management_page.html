<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BKTutor | Manage</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/tutor_management_page.css">
</head>

<body>
    <header class="nav">
        <div class="container nav-inner">
            <a class="nav-brand" href="/tutor_profile.html" aria-label="Tutor Home">
                <img src="/static/images/hcmut.svg" alt="BKTutor">
                <span>BKTutor</span>
            </a>
            <nav class="nav-links">
                <a href="/tutor_profile.html">Profile</a>
                <a href="/tutor_management_page.html" class="active">Manage</a>
                <a href="/tutor_manage_session.html">Sessions</a>
            </nav>
            <div class="spacer"></div>
            <button id="logoutBtn" class="btn primary" type="button">Log out</button>
        </div>
    </header>
    <main>
        <div class="container">
            <div id="alertBox" class="alert"></div>

            <div class="page-header">
                <h1>Availability Management</h1>
                <p>Configure your weekly schedule and manage your teaching availability</p>
            </div>

            <!-- Policy Limits -->
            <div class="policy-card">
                <div class="policy-header">
                    üìã Policy Constraints
                </div>
                <div class="policy-grid">
                    <div class="policy-item">
                        <div class="label">Allowed Hours</div>
                        <div class="value">7:00 - 22:00</div>
                    </div>
                    <div class="policy-item">
                        <div class="label">Max Slots / Day</div>
                        <div class="value">8 slots</div>
                    </div>
                    <div class="policy-item">
                        <div class="label">Max Slots / Week</div>
                        <div class="value">30 slots</div>
                    </div>
                    <div class="policy-item" id="weekUsageItem">
                        <div class="label">Current Week Usage</div>
                        <div class="value" id="weekUsage">0 / 30</div>
                    </div>
                </div>
            </div>

            <!-- Week Controls -->
            <div class="week-controls">
                <div class="week-nav">
                    <button id="prevWeek">‚óÄ</button>
                    <div class="week-display" id="weekDisplay">Nov 25 - Dec 1, 2025</div>
                    <button id="nextWeek">‚ñ∂</button>
                </div>
                <div class="spacer"></div>
                <button class="btn secondary" id="copyLastWeek">üìã Copy Last Week</button>
                <button class="btn danger" id="bulkDeleteUnpublished">üóëÔ∏è Bulk Delete Unpublished</button>
            </div>

            <!-- Calendar -->
            <div class="calendar-card">
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>Available Slots</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color booked"></div>
                        <span>Booked Sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color exception"></div>
                        <span>Exceptions</span>
                    </div>
                </div>
                <div id="calendarContainer"></div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="availability">Availability Slots</button>
                <button class="tab" data-tab="requests">Booking Requests</button>
                <button class="tab" data-tab="exceptions">Exceptions</button>
            </div>

            <!-- Availability Slots Table -->
            <div class="tab-content active" id="availabilityTab">
                <div class="slots-table-card">
                    <div class="table-header">
                        <h2>üìÖ Availability Slots</h2>
                        <div class="table-actions">
                            <button class="btn success" id="addSlotBtn">‚ûï Add Slots</button>
                            <button class="btn primary" id="publishAllBtn">‚úì Publish All</button>
                        </div>
                    </div>
                    <table id="slotsTable">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Day</th>
                                <th>Time</th>
                                <th>Duration</th>
                                <th>Mode</th>
                                <th>Location</th>
                                <th>Capacity</th>
                                <th>Lead Time</th>
                                <th>Cancel Window</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="slotsTableBody">
                            <!-- Slots will be rendered here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- NEW: Booking Requests Tab -->
            <div class="tab-content" id="requestsTab">
                <div class="slots-table-card">
                    <div class="table-header">
                        <h2>üìã Booking Requests</h2>
                    </div>
                    <table id="requestsTable">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Email</th>
                                <th>Session</th>
                                <th>Message</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody">
                            <!-- Requests will be rendered here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Exceptions Tab -->
            <div class="tab-content" id="exceptionsTab">
                <div class="slots-table-card">
                    <div class="table-header">
                        <h2>Blackout Dates & Exceptions</h2>
                        <button class="btn success" id="addExceptionBtn">‚ûï Add Exception</button>
                    </div>
                    <table id="exceptionsTable">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Reason</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="exceptionsTableBody">
                            <tr>
                                <td colspan="3" style="text-align: center; padding: 40px; color: #64748b;">
                                    No exceptions configured
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Slot Modal -->
    <div id="slotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Availability Slot</div>
            <form id="slotForm">
                <!-- Course Information (Required) -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Course Code <span class="required">*</span></label>
                        <input type="text" id="courseCode" placeholder="e.g., CO2013" style="text-transform: uppercase;" required>
                    </div>
                    <div class="form-group">
                        <label>Course Title <span class="required">*</span></label>
                        <input type="text" id="courseTitle" placeholder="e.g., Operating Systems" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Recurrence Type</label>
                    <select id="recurrence">
                        <option value="once">One-time</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group" id="dayGroup">
                        <label>Day <span class="required" id="dayRequired">*</span></label>
                        <select id="slotDay" required>
                            <option value="">Select day</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                            <option value="Sunday">Sunday</option>
                        </select>
                        <small class="form-hint" id="dayHint" style="display: none;">Auto-filled from date</small>
                    </div>
                    <div class="form-group" id="dateGroup">
                        <label>Date <span class="required" id="dateRequired" style="display: none;">*</span></label>
                        <input type="date" id="slotDate">
                        <small class="form-hint" id="dateHint">Required for one-time slots</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Time <span class="required">*</span></label>
                        <select id="startTime" required>
                            <option value="">Select time</option>
                            <option value="07:00">07:00 AM</option>
                            <option value="08:00">08:00 AM</option>
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">01:00 PM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                            <option value="17:00">05:00 PM</option>
                            <option value="18:00">06:00 PM</option>
                            <option value="19:00">07:00 PM</option>
                            <option value="20:00">08:00 PM</option>
                            <option value="21:00">09:00 PM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration (minutes)</label>
                        <select id="duration" required>
                            <option value="30">30 min</option>
                            <option value="60" selected>60 min</option>
                            <option value="90">90 min</option>
                            <option value="120">120 min</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Mode</label>
                        <select id="mode" required>
                            <option value="online">Online</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Capacity</label>
                        <input type="number" id="capacity" min="1" max="20" value="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Location (for offline mode)</label>
                    <input type="text" id="location" placeholder="e.g., Room B1-101">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Lead Time (hours)</label>
                        <input type="number" id="leadTime" min="1" max="72" value="24">
                    </div>
                    <div class="form-group">
                        <label>Cancel Window (hours)</label>
                        <input type="number" id="cancelWindow" min="1" max="48" value="12">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn secondary" id="cancelSlotBtn">Cancel</button>
                    <button type="submit" class="btn success">Save Slot</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Exception Modal -->
    <div id="exceptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Exception</div>
            <form id="exceptionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="exceptionStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="exceptionEndDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Time (optional)</label>
                        <input type="time" id="exceptionStartTime">
                    </div>
                    <div class="form-group">
                        <label>End Time (optional)</label>
                        <input type="time" id="exceptionEndTime">
                    </div>
                </div>
                <div class="form-group">
                    <label>Reason</label>
                    <textarea id="exceptionReason" rows="3" placeholder="e.g., Holiday, Conference, etc."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn secondary" id="cancelExceptionBtn">Cancel</button>
                    <button type="submit" class="btn success">Save Exception</button>
                </div>
            </form>
        </div>
    </div>
    <footer class="footer">
        <div class="container" style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: space-between;">
            <div>(c) 2025 HCMUT - Privacy - Terms</div>
            <div>Support: <a href="mailto:support@hcmut.edu.vn">support@hcmut.edu.vn</a></div>
        </div>
    </footer>
    <script src="/static/js/tutor_management_page.js"></script>
</body>

</html>